<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chronoswood.doublechoose.dao.WillDao">
    <insert id="storeWill" useGeneratedKeys="true">
        INSERT INTO will(`student_id`, `project_id`, `period_id`) VALUES
            <foreach collection="projectIds" item="projectId" separator=",">
                (
                select id from student where user_name=#{studentUserName},
                #{projectId},
                #{periodId}
                )
            </foreach>
    </insert>

    <update id="acceptWill">
        UPDATE will JOIN director JOIN project ON will.period_id=project.id AND project.director_id=director.id AND director.user_name=#{directorUserName}
        SET accepted = 1 WHERE id IN
        <foreach collection="willIds" item="willId" separator="," open="(" close=")">
            #{willId}
        </foreach>
    </update>
</mapper>